CSI-236 UNIX System Administration
Mr. Seabrook
Spring 2011

            Assignment 7: Installing a Service

A. Things to do
   1. We'll install a new service during this assignment
      generally along the lines of Steve Litt's tutorial
      on socket programming at 
      http://www.troubleshooters.com/codecorn/sockets/
      which you should read.  We'll create a one-way
      service only so you can skip the last half on the
      bi-directional implementation.

   2. Create the BASH service script shown below and test
      execute it, making sure that the /tmp/log.log file
      gets written correctly.  Copy the hello script to 
      /usr/local/sbin which you may have to create if you 
      don't already have one.  Make sure permissions are 
      755 for both the script and the directory.

   3. Check your /etc/services file for a defined hello
      service port.  My /etc/services file already had a 
      hello service on port 1789 (tcp) so I just used that.
      If you don't have a hello service defined edit the
      /etc/services file as root and type in definitions
      for it as both tcp and udp port 1789 just like the
      others in the file.

   4. Create the xinetd script shown below with your port 
      number in it and the correct server file name and
      install it in the /etc/xinetd.d directory.  If you don't
      have xinetd you can install it with yum and then start
      it with the GUI services manager.


   5. Go to /etc/rc.d/init.d and restart xinetd with the command
      ./xinetd restart -- should look like this:

# cd /etc/rc.d/init.d
# ./xinetd restart
Stopping xinetd:                                           [  OK  ]
Starting xinetd:                                           [  OK  ]
# 
      You can also restart xinetd with the GUI services manager,
      of course.

  6. You telnet to port 1789 to get this service so you'll
      have to go to your System/Administration/Security Level 
      and Firewall tool and click on telnet to allow its use
      as a trusted service.
  7. Use telnet to get to localhost at your port number and see
      if you get the time-and-date response.  Check /tmp/log.log
      to make sure it's there as well.  Check the system
      log for messages in case you have problems.

  8. Save all your work on Vader.

B. Things to turn in: -- newservice.txt
   1. listing of your hello.sh service script
   2. listing of your /tmp/log.log
   3. listing of your /etc/xinetd.d/hello file
   4. listing of a few lines from your /etc/services
           showing the hello service ports
   5. listing of a few lines from your /var/log/messages showing
           your "Hello called" messages

C. File this Lab with your documentation after I return them.


D. Attachments
   1. The hello.sh script -- only a few lines!

#!/bin/bash
#hello.sh
#note absolute references to everything
#Seabrook 2011
/bin/echo -n "Hello World:" | /usr/bin/tee -a /tmp/log.log
/bin/date | /usr/bin/tee -a /tmp/log.log
/usr/bin/logger -is "Hello called"


    2. The xinetd hello script -- install your port number

# default: on
# description: Hello World socket server
service hello
{
# Here's the port number, I used port 1789 in the lab
   port			= 1789 
   socket_type		= stream
   wait			= no
   user			= nobody
# Here's the service program
   server		= /usr/local/sbin/hello.sh
   log_on_success      += USERID
   log_on_failure      += USERID
   disable              = no
}

    3. Example execution on my machine at home:

# ssh -p 1789 dick@localhost
ssh_exchange_identification: Connection closed by remote host
#
# cat /tmp/log.log
Hello World:Tue Mar  8 11:21:26 EST 2011
#
# telnet localhost 1789
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
Hello World:Tue Mar  8 11:22:03 EST 2011
dick[4404]: Hello called
Connection closed by foreign host.
# 
# cat /tmp/log.log
Hello World:Tue Mar  8 11:21:26 EST 2011
Hello World:Tue Mar  8 11:22:03 EST 2011
# 
# tail /var/log/messages
Mar  8 11:17:12 homeserver xinetd[4021]: START: hello pid=4375 from=::ffff:127.0.0.1
Mar  8 11:17:13 homeserver dick[4381]: Hello called
Mar  8 11:17:13 homeserver xinetd[4021]: EXIT: hello status=0 pid=4375 duration=1(sec)
Mar  8 11:21:26 homeserver xinetd[4021]: START: hello pid=4390 from=::ffff:127.0.0.1
Mar  8 11:21:26 homeserver dick[4396]: Hello called
Mar  8 11:21:26 homeserver xinetd[4021]: EXIT: hello status=0 pid=4390 duration=0(sec)
Mar  8 11:22:03 homeserver xinetd[4021]: START: hello pid=4399 from=::ffff:127.0.0.1
Mar  8 11:22:03 homeserver dick[4404]: Hello called
Mar  8 11:22:03 homeserver xinetd[4021]: EXIT: hello status=0 pid=4399 duration=0(sec)
# 

